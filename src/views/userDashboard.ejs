<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CodeSecure - User Dashboard</title>
  <link rel="stylesheet" href="/stylesheets/userDashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="main-container">
    <!-- Header Section -->
    <header class="header-section fade-in">
      <div class="brand-logo">
        <i class="fas fa-code"></i> CodeSecure
      </div>
      <nav class="navigation-menu">
        <a href="/dashboard" class="nav-link active">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <!-- <a href="/exams" class="nav-link">
          <i class="fas fa-file-alt"></i> Exams
        </a>
        <a href="/results" class="nav-link">
          <i class="fas fa-chart-line"></i> Results
        </a>
        <a href="/profile" class="nav-link">
          <i class="fas fa-user"></i> Profile
        </a> -->
      </nav>
      <div class="user-actions">
        <div class="user-info">
          <i class="fas fa-user-graduate"></i> 
          <span><%= user ? user.fullname || user.username : 'Student' %></span>
        </div>
        <!-- <a href="/settings" class="action-btn">
          <i class="fas fa-cog"></i> Settings
        </a> -->
        <a href="/logout" class="action-btn logout-btn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </div>
    </header>

    <main class="content-area">
      <div class="dashboard-container">
        <!-- Welcome Section -->
        <section class="welcome-section slide-up">
          <div class="welcome-card">
            <div class="welcome-content">
              <h1 class="welcome-title">
                <i class="fas fa-wave-square"></i> 
                Welcome Back, <span class="username"><%= user ? user.fullname || user.username : 'Student' %></span>!
              </h1>
              <p class="welcome-description">Ready to challenge yourself with your next coding exam?</p>
              
              <div class="quick-stats">
                <div class="quick-stat">
                  <div class="stat-icon">
                    <i class="fas fa-clipboard-check"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value"><%= userStats.totalExams || 0 %></span>
                    <span class="stat-label">Exams Completed</span>
                  </div>
                </div>
                <div class="quick-stat">
                  <div class="stat-icon">
                    <i class="fas fa-trophy"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value"><%= userStats.averageScore ? Math.round(userStats.averageScore) : 0 %>%</span>
                    <span class="stat-label">Average Score</span>
                  </div>
                </div>
                <div class="quick-stat">
                  <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value"><%= userStats.totalTimeTaken ? Math.round(userStats.totalTimeTaken) : 0 %> min</span>
                    <span class="stat-label">Total Time</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="welcome-illustration">
              <i class="fas fa-laptop-code"></i>
            </div>
          </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
          <!-- Available Exams Section -->
          <section class="exam-section slide-up">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-file-code"></i> Available Exams
              </h2>
              <div class="exam-count">
                <%= exams && exams.length > 0 ? exams.length : 0 %> exam<%= exams && exams.length !== 1 ? 's' : '' %> available
              </div>
            </div>

            <div class="exam-items">
              <% if (exams && exams.length > 0) { %>
                <% exams.forEach(exam => { %>
                  <div class="exam-card">
                    <div class="exam-card-header">
                      <div class="exam-title-section">
                        <h3 class="exam-title"><%= exam.title %></h3>
                        <div class="exam-meta-top">
                          <span class="exam-duration">
                            <i class="fas fa-clock"></i> <%= exam.duration %> min
                          </span>
                          <span class="exam-status status-<%= exam.status %>">
                            <i class="fas fa-circle"></i> <%= exam.status.toUpperCase() %>
                          </span>
                        </div>
                      </div>
                    </div>

                    <% if (exam.description) { %>
                      <p class="exam-description"><%= exam.description %></p>
                    <% } %>

                    <div class="exam-details">
                      <div class="exam-stats">
                        <% if (exam.questions && exam.questions.length > 0) { %>
                          <div class="stat-item">
                            <i class="fas fa-question-circle"></i>
                            <span><%= exam.questions.length %> Questions</span>
                          </div>
                        <% } %>
                        <% if (exam.totalMarks) { %>
                          <div class="stat-item">
                            <i class="fas fa-star"></i>
                            <span><%= exam.totalMarks %> Points</span>
                          </div>
                        <% } %>
                        <% if (exam.adminId && exam.adminId.fullname) { %>
                          <div class="stat-item">
                            <i class="fas fa-user-tie"></i>
                            <span>By <%= exam.adminId.fullname %></span>
                          </div>
                        <% } %>
                      </div>

                      <div class="exam-schedule">
                        <div class="schedule-item">
                          <i class="fas fa-calendar-alt"></i>
                          <div class="schedule-info">
                            <span class="schedule-label">Start Time</span>
                            <span class="schedule-value">
                              <%= new Date(exam.startDateTime).toLocaleDateString('en-US', { 
                                weekday: 'short', 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                              }) %>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <% 
                      const now = new Date();
                      const startTime = new Date(exam.startDateTime);
                      const endTime = new Date(startTime.getTime() + (exam.duration * 60000));
                      const canStart = now >= startTime && now <= endTime && exam.status === 'active';
                      const isPast = now > endTime;
                      const isFuture = now < startTime;
                    %>
                    
                    <div class="exam-action">
                      <% if (canStart) { %>
                        <a href="/exams/start/<%= exam._id %>" class="exam-btn exam-btn-primary">
                          <i class="fas fa-play"></i>
                          Start Exam
                        </a>
                      <% } else if (isPast) { %>
                        <button class="exam-btn exam-btn-disabled" disabled>
                          <i class="fas fa-times-circle"></i>
                          Exam Ended
                        </button>
                      <% } else if (isFuture) { %>
                        <button class="exam-btn exam-btn-pending" disabled>
                          <i class="fas fa-clock"></i>
                          Starts <%= startTime.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                        </button>
                      <% } else if (exam.status === 'draft') { %>
                        <button class="exam-btn exam-btn-disabled" disabled>
                          <i class="fas fa-edit"></i>
                          Draft - Not Available
                        </button>
                      <% } else { %>
                        <button class="exam-btn exam-btn-disabled" disabled>
                          <i class="fas fa-ban"></i>
                          Not Available
                        </button>
                      <% } %>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="no-exams-message">
                  <div class="no-exams-icon">
                    <i class="fas fa-file-alt"></i>
                  </div>
                  <h3>No Exams Available</h3>
                  <p>Your organization hasn't created any exams yet. Check back later for new challenges!</p>
                </div>
              <% } %>
            </div>
          </section>

          <!-- Recent Results Section -->
          <section class="results-section slide-up">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-chart-bar"></i> Recent Results
              </h2>
              <a href="/results" class="view-all-link">
                View All <i class="fas fa-arrow-right"></i>
              </a>
            </div>

            <div class="results-list">
              <% if (recentResults && recentResults.length > 0) { %>
                <% recentResults.forEach(result => { %>
                  <div class="result-card">
                    <div class="result-header">
                      <div class="result-info">
                        <h4 class="result-title"><%= result.examTitle %></h4>
                        <p class="result-date">
                          <i class="fas fa-calendar"></i> Completed <%= 
                            new Date(result.createdAt).toLocaleDateString('en-US', { 
                              month: 'short', 
                              day: 'numeric',
                              year: new Date(result.createdAt).getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                            }) 
                          %>
                        </p>
                      </div>
                      <div class="result-score <%= result.percentage >= 90 ? 'high-score' : result.percentage >= 70 ? 'medium-score' : 'low-score' %>">
                        <span class="score-value"><%= Math.round(result.percentage) %>%</span>
                        <i class="fas fa-<%= result.percentage >= 90 ? 'trophy' : result.percentage >= 70 ? 'medal' : 'thumbs-up' %>"></i>
                      </div>
                    </div>
                    <div class="result-details">
                      <div class="result-stat">
                        <span class="stat-label">Time Taken</span>
                        <span class="stat-value"><%= result.timeTaken || 0 %> min</span>
                      </div>
                      <div class="result-stat">
                        <span class="stat-label">Questions</span>
                        <span class="stat-value"><%= result.questionsAttempted || 0 %>/<%= result.totalQuestions || 0 %></span>
                      </div>
                      <div class="result-stat">
                        <span class="stat-label">Score</span>
                        <span class="stat-value"><%= result.totalScore || 0 %>/<%= result.maxScore || 0 %></span>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="no-results-message">
                  <div class="no-results-icon">
                    <i class="fas fa-chart-bar"></i>
                  </div>
                  <h3>No Results Yet</h3>
                  <p>Complete your first exam to see your results here!</p>
                </div>
              <% } %>
            </div>
          </section>

          <!-- Progress Section -->
          <!-- <section class="progress-section slide-up">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-chart-line"></i> Your Progress
              </h2>
            </div>

            <div class="progress-cards">
              <div class="progress-card">
                <div class="progress-header">
                  <div class="progress-info">
                    <h4 class="progress-title">Monthly Goal</h4>
                    <p class="progress-description">Complete 5 exams this month</p>
                  </div>
                  <div class="progress-percentage">60%</div>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 60%"></div>
                </div>
                <div class="progress-footer">
                  <span class="progress-current">3 of 5 completed</span>
                </div>
              </div>

              <div class="progress-card">
                <div class="progress-header">
                  <div class="progress-info">
                    <h4 class="progress-title">Skill Development</h4>
                    <p class="progress-description">JavaScript proficiency</p>
                  </div>
                  <div class="progress-percentage">87%</div>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill progress-fill-secondary" style="width: 87%"></div>
                </div>
                <div class="progress-footer">
                  <span class="progress-current">Advanced level</span>
                </div>
              </div>
            </div>
          </section> -->

          <!-- Quick Actions Section -->
          <!-- <section class="quick-actions-section slide-up">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-bolt"></i> Quick Actions
              </h2>
            </div>

            <div class="quick-actions-grid">
              <a href="/exams" class="quick-action-card">
                <div class="action-icon">
                  <i class="fas fa-file-alt"></i>
                </div>
                <h4 class="action-title">Browse Exams</h4>
                <p class="action-description">View all available exams</p>
              </a>

              <a href="/results" class="quick-action-card">
                <div class="action-icon">
                  <i class="fas fa-chart-bar"></i>
                </div>
                <h4 class="action-title">View Results</h4>
                <p class="action-description">Check your exam history</p>
              </a>

              <a href="/profile" class="quick-action-card">
                <div class="action-icon">
                  <i class="fas fa-user-edit"></i>
                </div>
                <h4 class="action-title">Update Profile</h4>
                <p class="action-description">Manage your account</p>
              </a>

              <a href="/settings" class="quick-action-card">
                <div class="action-icon">
                  <i class="fas fa-cog"></i>
                </div>
                <h4 class="action-title">Settings</h4>
                <p class="action-description">Customize preferences</p>
              </a>
            </div>
          </section> -->
        </div>
      </div>
    </main>
  </div>

  <script src="/javascripts/sessionProtection.js"></script>
  <script>
    // Add animation delays for staggered effect
    document.addEventListener('DOMContentLoaded', function() {
      const elements = document.querySelectorAll('.slide-up');
      elements.forEach((element, index) => {
        element.style.animationDelay = `${index * 0.1}s`;
      });

      // Add hover effects for exam cards
      const examCards = document.querySelectorAll('.exam-card');
      examCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });
      });
    });
  </script>
</body>
</html>
