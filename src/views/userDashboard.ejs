<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CodeSecure - User Dashboard</title>
  <link rel="stylesheet" href="/stylesheets/userDashboard.css" />
</head>
<body>
  <div class="main-container">
    <header class="header-section">
      <div class="brand-logo">CodeSecure</div>
      <nav class="navigation-menu">
        <a href="/dashboard" class="nav-link">Dashboard</a>
        <a href="/exams" class="nav-link">Exams</a>
        <a href="/results" class="nav-link">Results</a>
        <a href="/profile" class="nav-link">Profile</a>
      </nav>
      <div class="user-actions">
        <a href="/settings" class="action-btn">Settings</a>
        <a href="/logout" class="action-btn logout-btn">Logout</a>
      </div>
    </header>

    <main class="content-area">
      <div class="dashboard-grid">
        <section class="welcome-card">
          <h1 class="welcome-title">Welcome Back, <%= user.username %>!</h1>
          <p class="welcome-description">Ready to take your next coding challenge?</p>
          <div class="quick-stats">
            <div class="quick-stat">
              <span class="stat-value">15</span>
              <span class="stat-name">Exams Completed</span>
            </div>
            <div class="quick-stat">
              <span class="stat-value">87%</span>
              <span class="stat-name">Average Score</span>
            </div>
          </div>
        </section>

        <section class="exam-list">
          <h2 class="section-title">Available Exams from Your Organization</h2>
          <div class="exam-items">
            <% if (exams && exams.length > 0) { %>
              <% exams.forEach(exam => { %>
                <div class="exam-card">
                  <div class="exam-header">
                    <h3 class="exam-name"><%= exam.title %></h3>
                    <span class="exam-duration"><%= exam.duration %> min</span>
                  </div>
                  <% if (exam.description) { %>
                    <p class="exam-description"><%= exam.description %></p>
                  <% } %>
                  <div class="exam-meta">
                    <span class="exam-status status-<%= exam.status %>"><%= exam.status.toUpperCase() %></span>
                    <% if (exam.questions && exam.questions.length > 0) { %>
                      <span class="exam-questions"><%= exam.questions.length %> Questions</span>
                    <% } %>
                    <% if (exam.totalMarks) { %>
                      <span class="exam-marks"><%= exam.totalMarks %> Points</span>
                    <% } %>
                  </div>
                  <div class="exam-schedule">
                    <div class="schedule-info">
                      <strong>Start Time:</strong> 
                      <%= new Date(exam.startDateTime).toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      }) %>
                    </div>
                    <% if (exam.adminId && exam.adminId.fullname) { %>
                      <div class="created-by">
                        <small>Created by: <%= exam.adminId.fullname %></small>
                      </div>
                    <% } %>
                  </div>
                  <% 
                    const now = new Date();
                    const startTime = new Date(exam.startDateTime);
                    const endTime = new Date(startTime.getTime() + (exam.duration * 60000));
                    const canStart = now >= startTime && now <= endTime && exam.status === 'active';
                    const isPast = now > endTime;
                    const isFuture = now < startTime;
                  %>
                  
                  <% if (canStart) { %>
                    <a href="/exams/start/<%= exam._id %>" class="start-exam-btn">Start Exam</a>
                  <% } else if (isPast) { %>
                    <button class="start-exam-btn disabled" disabled>Exam Ended</button>
                  <% } else if (isFuture) { %>
                    <button class="start-exam-btn disabled" disabled>
                      Starts <%= startTime.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                    </button>
                  <% } else if (exam.status === 'draft') { %>
                    <button class="start-exam-btn disabled" disabled>Draft - Not Available</button>
                  <% } else { %>
                    <button class="start-exam-btn disabled" disabled>Not Available</button>
                  <% } %>
                </div>
              <% }); %>
            <% } else { %>
              <div class="no-exams-message">
                <h3>No Exams Available</h3>
                <p>Your organization hasn't created any exams yet. Check back later!</p>
              </div>
            <% } %>
          </div>
        </section>

        <section class="recent-results">
          <h2 class="section-title">Recent Results</h2>
          <div class="results-list">
            <div class="result-item">
              <div class="result-info">
                <h3 class="result-exam">JavaScript Fundamentals</h3>
                <p class="result-date">Completed 2 days ago</p>
              </div>
              <div class="result-score high-score">92%</div>
            </div>
            <div class="result-item">
              <div class="result-info">
                <h3 class="result-exam">Data Structures</h3>
                <p class="result-date">Completed 1 week ago</p>
              </div>
              <div class="result-score medium-score">78%</div>
            </div>
            <div class="result-item">
              <div class="result-info">
                <h3 class="result-exam">SQL Queries</h3>
                <p class="result-date">Completed 2 weeks ago</p>
              </div>
              <div class="result-score high-score">95%</div>
            </div>
            <div class="result-item">
              <div class="result-info">
                <h3 class="result-exam">Web Development</h3>
                <p class="result-date">Completed 3 weeks ago</p>
              </div>
              <div class="result-score medium-score">83%</div>
            </div>
          </div>
        </section>

        <!-- <section class="achievements-section">
          <h2 class="section-title">Achievements</h2>
          <div class="achievements-grid">
            <div class="achievement-card earned">
              <div class="achievement-icon">üèÜ</div>
              <h3 class="achievement-title">First Exam</h3>
              <p class="achievement-desc">Complete your first exam</p>
            </div>
            <div class="achievement-card earned">
              <div class="achievement-icon">‚≠ê</div>
              <h3 class="achievement-title">High Scorer</h3>
              <p class="achievement-desc">Score 90% or higher</p>
            </div>
            <div class="achievement-card">
              <div class="achievement-icon">üî•</div>
              <h3 class="achievement-title">Streak Master</h3>
              <p class="achievement-desc">Complete 5 exams in a row</p>
            </div>
            <div class="achievement-card">
              <div class="achievement-icon">üíé</div>
              <h3 class="achievement-title">Perfect Score</h3>
              <p class="achievement-desc">Score 100% on any exam</p>
            </div>
          </div>
        </section> -->
      </div>
    </main>
  </div>
</body>
</html>
